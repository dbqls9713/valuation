"""
Schema definitions for Silver datasets with descriptions.
"""
from data.silver.core.dataset import ColumnSpec
from data.silver.core.dataset import DatasetSchema

FACTS_LONG_SCHEMA = DatasetSchema(
    name='facts_long',
    description=
    'All filed versions of SEC XBRL facts, filtered by metric_specs (for PIT)',
    columns=[
        ColumnSpec('cik10',
                   'str',
                   nullable=False,
                   description='CIK padded to 10 digits'),
        ColumnSpec('metric',
                   'str',
                   nullable=False,
                   description='Metric name (CFO, CAPEX, SHARES)'),
        ColumnSpec('namespace',
                   'str',
                   nullable=False,
                   description='XBRL namespace (us-gaap)'),
        ColumnSpec('tag', 'str', nullable=False, description='XBRL tag name'),
        ColumnSpec('unit',
                   'str',
                   nullable=False,
                   description='Unit (USD, shares)'),
        ColumnSpec('end',
                   'datetime64[ns]',
                   nullable=False,
                   description='Period end date'),
        ColumnSpec('filed',
                   'datetime64[ns]',
                   nullable=False,
                   description='Filing date'),
        ColumnSpec('fy',
                   'int64',
                   nullable=False,
                   description='Fiscal year from SEC filing'),
        ColumnSpec('fp',
                   'str',
                   nullable=False,
                   description='Fiscal period (Q1, Q2, Q3, FY)'),
        ColumnSpec('form',
                   'str',
                   nullable=False,
                   description='Form type (10-K, 10-Q)'),
        ColumnSpec('val',
                   'float64',
                   nullable=False,
                   description='Value (YTD for cash flow items)'),
        ColumnSpec('fiscal_year',
                   'int64',
                   nullable=False,
                   description='Calculated fiscal year from company FYE'),
    ],
    primary_key=['cik10', 'metric', 'end', 'fy', 'fp', 'filed'])

METRICS_QUARTERLY_SCHEMA = DatasetSchema(
    name='metrics_quarterly',
    description='All filed versions including restatements (for PIT support)',
    columns=[
        ColumnSpec('cik10',
                   'str',
                   nullable=False,
                   description='CIK padded to 10 digits'),
        ColumnSpec('metric',
                   'str',
                   nullable=False,
                   description='Metric name (CFO, CAPEX, SHARES)'),
        ColumnSpec('end',
                   'datetime64[ns]',
                   nullable=False,
                   description='Period end date'),
        ColumnSpec('filed',
                   'datetime64[ns]',
                   nullable=False,
                   description='Filing date'),
        ColumnSpec('fy',
                   'int64',
                   nullable=False,
                   description='Fiscal year from SEC filing'),
        ColumnSpec('fp',
                   'str',
                   nullable=False,
                   description='Fiscal period (Q1, Q2, Q3, Q4)'),
        ColumnSpec('fiscal_year',
                   'int64',
                   nullable=False,
                   description='Calculated fiscal year'),
        ColumnSpec('q_val',
                   'float64',
                   nullable=False,
                   description='Discrete quarterly value'),
        ColumnSpec('ttm_val',
                   'float64',
                   nullable=True,
                   description='Trailing 12-month sum (null for <4 quarters)'),
        ColumnSpec('tag', 'str', nullable=False, description='XBRL tag used'),
    ],
    primary_key=['cik10', 'metric', 'end', 'fp', 'filed'])

PRICES_DAILY_SCHEMA = DatasetSchema(
    name='prices_daily',
    description='Daily OHLCV prices from Stooq',
    columns=[
        ColumnSpec('symbol',
                   'str',
                   nullable=False,
                   description='Ticker symbol (e.g., AAPL.US)'),
        ColumnSpec('date',
                   'datetime64[ns]',
                   nullable=False,
                   description='Trading date'),
        ColumnSpec('open', 'float64', nullable=False, description='Open price'),
        ColumnSpec('high', 'float64', nullable=False, description='High price'),
        ColumnSpec('low', 'float64', nullable=False, description='Low price'),
        ColumnSpec('close',
                   'float64',
                   nullable=False,
                   description='Close price'),
        ColumnSpec('volume',
                   'float64',
                   nullable=False,
                   description='Trading volume'),
    ],
    primary_key=['symbol', 'date'])

COMPANIES_SCHEMA = DatasetSchema(
    name='companies',
    description='Company master table with fiscal year end and filing metadata',
    columns=[
        ColumnSpec('cik10',
                   'str',
                   nullable=False,
                   description='CIK padded to 10 digits'),
        ColumnSpec('ticker',
                   'str',
                   nullable=False,
                   description='Primary ticker symbol'),
        ColumnSpec('title',
                   'str',
                   nullable=False,
                   description='Company legal name'),
        ColumnSpec('fye_mmdd',
                   'str',
                   nullable=False,
                   description='Fiscal year end (MMDD format)'),
        ColumnSpec('first_filing_date',
                   'datetime64[ns]',
                   nullable=True,
                   description='Date of first SEC filing'),
    ],
    primary_key=['cik10'])
